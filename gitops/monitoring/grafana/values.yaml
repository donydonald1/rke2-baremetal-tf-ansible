grafana:
  admin:
    existingSecret: grafana-admin-creds
    userKey: username
    passwordKey: password
  assertNoLeakedSecrets: false
  initChownData:
    enabled: false
  useStatefulSet: true
  persistence:
    enabled: true
    type: statefulset
    storageClassName: nfs-csi
    accessModes: [ "ReadWriteMany" ]
    size: 5Gi

  grafana.ini:
    server:
      root_url: https://grafana.prod.techsecom.io
    analytics:
      check_for_updates: true
      check_for_plugin_updates: true
    auth:
      auto_login: true
      disable_signout_menu: false
    auth.generic_oauth:
      enabled: true
      client_id: <path:secret/data/grafana#client_id>
      client_secret: <path:secret/data/grafana#client_secret>
      allow_sign_up: true
      scopes: openid profile email roles
      auth_url: <path:secret/data/grafana#auth_url>
      token_url: <path:secret/data/grafana#token_url>
      api_url: <path:secret/data/grafana#api_url>
      use_pkce: true
      use_refresh_token: true
    users:
      auto_assign_org: true
      auto_assign_org_role: Editor
    paths:
      data: /var/lib/grafana/data
      logs: /var/log/grafana
      plugins: /var/lib/grafana/plugins
      provisioning: /etc/grafana/provisioning
    database:
      type: postgres
      host: "cnpg-cluster-rw.cnpg-system.svc.cluster.local:5432"
      name: grafana
      user: $__file{/etc/secrets/username}
      password: $__file{/etc/secrets/password}
      ssl_mode: disable
  extraSecretMounts:
  - name: grafana-db-secret
    secretName: grafana-user-secret
    mountPath: /etc/secrets
    readOnly: true
  serviceMonitor:
    enabled: true
  serviceAccount:
    autoMount: true
  extraEnvFrom:
  - secretRef:
      name: grafana-user-secret
  extraEnv:
  - name: GF_DATABASE_USER
    valueFrom:
      secretKeyRef:
        name: grafana-user-secret
        key: username
  - name: GF_DATABASE_PASSWORD__FILE
    value: /etc/secrets/password

  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      kubernetes.io/ingress.class: "nginx"
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      cert-manager.io/revision-history-limit: "3"
      external-dns.alpha.kubernetes.io/enabled: "true"
      cert-manager.io/duration: "2160h"
      cert-manager.io/renew-before: "720h"

    hosts: [ grafana.prod.techsecom.io ]
    tls:
    - hosts:
      - grafana.prod.techsecom.io
      secretName: grafana-cert-tls
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
      - name: "default"
        orgId: 1
        folder: ""
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/default

  dashboards:
    default:
      pihole-ui:
        gnetId: 14475
        revision: 4
        datasource: Prometheus
        inputs:
        - name: DS_PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus
        - name: VAR_PIHOLEDEVICES
          type: constant
          value: "3"

      blackbox:
        gnetId: 7587
        revision: 3
        datasource: Prometheus
        inputs:
        - name: DS_SIGNCL-PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus

      blackbox-icmp:
        gnetId: 20338
        revision: 3
        datasource: Prometheus
        inputs:
        - name: DS_PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus

      synology-overview:
        gnetId: 14364
        revision: 10
        datasource: Prometheus
        inputs:
        - name: DS_PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus
        - name: VAR_NASDEVICES
          type: constant
          value: "1"

      synology-detail:
        gnetId: 14284
        revision: 10
        datasource: Prometheus
        inputs:
        - name: DS_PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus
        - name: VAR_NASDEVICES
          type: constant
          value: "1"

      minio:
        gnetId: 13502
        revision: 26
        datasource: Prometheus
        inputs:
        - name: DS_PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus

      volsync:
        gnetId: 21356
        revision: 3
        datasource: Prometheus
        inputs:
        - name: DS_PROMETHEUS
          pluginId: prometheus
          type: datasource
          value: Prometheus
        - name: VAR_REPLICATIONDESTNAME
          type: constant
          value: ".*"
