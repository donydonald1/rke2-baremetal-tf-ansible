apiVersion: v1
data:
    avp-helm.yaml: |-
        apiVersion: argoproj.io/v1alpha1
        kind: ConfigManagementPlugin
        metadata:
            name: avp-helm
        spec:
            allowConcurrency: true
            discover:
                find:
                    command:
                      - sh
                      - "-c"
                      - "find . -name 'Chart.yaml' && find . -name 'values.yaml'"
            init:
                command:
                  - sh
                  - "-c"
                  - |
                    helm dependency build
            generate:
                command:
                  - sh
                  - "-c"
                  - |
                    helm template $ARGOCD_APP_NAME --include-crds -n $ARGOCD_APP_NAMESPACE . |
                    argocd-vault-plugin generate -
            lockRepo: false
    avp-k8s.yaml: |-
        apiVersion: argoproj.io/v1alpha1
        kind: ConfigManagementPlugin
        metadata:
            name: avp-k8s
        spec:
            allowConcurrency: true
            discover:
                find:
                    command:
                      - sh
                      - "-c"
                      - "find . -name '*.yaml' | xargs -I {} grep \"<path\\|avp\\.kubernetes\\.io\" {} | grep ."
            generate:
                command:
                  - argocd-vault-plugin
                  - generate
                  - "."
            lockRepo: false
    avp-kustomize.yaml: |-
        apiVersion: argoproj.io/v1alpha1
        kind: ConfigManagementPlugin
        metadata:
            name: avp-kustomize
        spec:
            allowConcurrency: true
            discover:
                find:
                    command:
                      - find
                      - "."
                      - -name
                      - kustomization.yaml
            generate:
                command:
                  - sh
                  - "-c"
                  - "kustomize build . | argocd-vault-plugin generate -"
            lockRepo: false
immutable: false
kind: ConfigMap
metadata:
    name: avp-cmp-plugin
    namespace: argocd
